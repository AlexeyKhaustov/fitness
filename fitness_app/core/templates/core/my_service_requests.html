{% extends 'core/base.html' %}

{% block title %}Мои услуги - FitnessVideo{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 py-12">
    <h1 class="text-3xl font-bold text-white mb-8">Мои заявки на услуги</h1>

    {% if requests %}
        <div class="grid grid-cols-1 gap-6">
            {% for req in requests %}
            <div class="bg-gray-800 rounded-2xl p-6 border-l-4
                {% if req.status == 'completed' %}border-green-500
                {% elif req.status == 'paid' %}border-blue-500
                {% elif req.status == 'processing' %}border-yellow-500
                {% elif req.status == 'invoice_sent' %}border-purple-500
                {% else %}border-gray-500{% endif %}">

                <div class="flex flex-wrap justify-between items-start mb-4">
                    <div>
                        <h2 class="text-xl font-bold text-white mb-1">{{ req.service.name }}</h2>
                        <p class="text-gray-400 text-sm">Заявка №{{ req.id }} от {{ req.created_at|date:"d.m.Y" }}</p>
                    </div>
                    <div class="text-right">
                        <div class="text-2xl font-bold text-green-400">{{ req.amount }} ₽</div>
                        <span class="inline-block px-3 py-1 rounded-full text-xs font-semibold mt-2
                            {% if req.status == 'new' %}bg-gray-700 text-gray-300
                            {% elif req.status == 'processing' %}bg-yellow-900 text-yellow-300
                            {% elif req.status == 'invoice_sent' %}bg-purple-900 text-purple-300
                            {% elif req.status == 'paid' %}bg-blue-900 text-blue-300
                            {% elif req.status == 'completed' %}bg-green-900 text-green-300
                            {% elif req.status == 'cancelled' %}bg-red-900 text-red-300
                            {% endif %}">
                            {{ req.get_status_display }}
                        </span>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <p class="text-gray-400 text-sm">Контактные данные:</p>
                        <p class="text-white">{{ req.full_name }}</p>
                        <p class="text-white">{{ req.email }}</p>
                        <p class="text-white">{{ req.phone }}</p>
                    </div>
                    {% if req.additional_info %}
                    <div>
                        <p class="text-gray-400 text-sm">Дополнительная информация:</p>
                        <p class="text-gray-300">{{ req.additional_info|linebreaksbr }}</p>
                    </div>
                    {% endif %}
                </div>

                {% if req.status == 'completed' and req.result_file or req.result_text or req.result_url %}
                <div class="mt-4 pt-4 border-t border-gray-700">
                    <p class="text-gray-400 text-sm mb-2">Результат услуги:</p>
                    <div class="space-y-2">
                        {% if req.result_file %}
                        <a href="{{ req.result_file.url }}" target="_blank"
                           class="inline-flex items-center text-purple-400 hover:text-purple-300">
                            <i class="fa-solid fa-file-pdf mr-2"></i>
                            Скачать файл
                        </a>
                        {% endif %}
                        {% if req.result_text %}
                        <div class="text-gray-300 bg-gray-900 p-3 rounded-lg">
                            {{ req.result_text|linebreaks }}
                        </div>
                        {% endif %}
                        {% if req.result_url %}
                        <a href="{{ req.result_url }}" target="_blank"
                           class="inline-flex items-center text-purple-400 hover:text-purple-300">
                            <i class="fa-solid fa-external-link mr-2"></i>
                            Перейти по ссылке
                        </a>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="bg-gray-800 rounded-2xl p-12 text-center">
            <i class="fa-solid fa-file-circle-question text-5xl text-gray-600 mb-4"></i>
            <h3 class="text-xl font-bold text-gray-400 mb-2">У вас пока нет заявок</h3>
            <p class="text-gray-500 mb-6">Перейдите в раздел услуг, чтобы оставить заявку</p>
            <a href="{% url 'home' %}#services"
               class="inline-block bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                Смотреть услуги
            </a>
        </div>
    {% endif %}
</div>
{% endblock %}